const n={key:"372cfc56cbmsh0f91865607fd758p11b536jsn7b1ee43c9632",host:"wft-geo-db.p.rapidapi.com",baseUrl:"https://wft-geo-db.p.rapidapi.com/v1/geo"},c="checkout_form_data";class d{constructor(){this.apiKey=n.key,this.apiHost=n.host,this.baseUrl=n.baseUrl}async searchCountries(t){return this.fetchApi(`/countries?namePrefix=${encodeURIComponent(t)}&limit=10`)}async searchCities(t,e){return this.fetchApi(`/cities?countryIds=${t}&namePrefix=${encodeURIComponent(e)}&limit=10`)}async fetchApi(t,e=3){let r;for(let s=0;s<e;s++)try{const o=await fetch(`${this.baseUrl}${t}`,{headers:{"X-RapidAPI-Key":this.apiKey,"X-RapidAPI-Host":this.apiHost}});if(!o.ok)throw new Error(`API request failed with status ${o.status}`);return(await o.json()).data||[]}catch(o){r=o,console.warn(`API request attempt ${s+1} failed:`,o),s<e-1&&await new Promise(a=>setTimeout(a,1e3*(s+1)))}throw r}}class u{constructor(){this.api=new d,this.setupDOM(),this.setupListeners(),this.loadSavedData(),this.searchTimeout=null,this.selectedCountry=null}setupDOM(){this.countryInput=document.getElementById("countryInput"),this.cityInput=document.getElementById("cityInput"),this.countryDropdown=document.getElementById("countryDropdown"),this.cityDropdown=document.getElementById("cityDropdown"),this.countryLoader=document.getElementById("countryLoader"),this.cityLoader=document.getElementById("cityLoader")}setupListeners(){this.countryInput.addEventListener("input",()=>this.handleCountryInput()),this.countryInput.addEventListener("focus",()=>this.handleCountryFocus()),this.cityInput.addEventListener("input",()=>this.handleCityInput()),this.cityInput.addEventListener("focus",()=>this.handleCityFocus()),document.addEventListener("click",e=>this.handleOutsideClick(e)),document.querySelectorAll("#checkout-form input, #checkout-form select, #checkout-form textarea").forEach(e=>{e.addEventListener("change",()=>this.saveFormData())})}handleCountryInput(){clearTimeout(this.searchTimeout);const t=this.countryInput.value.trim();if(t.length<2){this.countryDropdown.classList.remove("active");return}this.searchTimeout=setTimeout(()=>{this.searchCountries(t)},300)}handleCountryFocus(){this.countryInput.value.length>=2&&this.countryDropdown.classList.add("active")}handleCityInput(){clearTimeout(this.searchTimeout);const t=this.cityInput.value.trim();if(!this.selectedCountry||t.length<2){this.cityDropdown.classList.remove("active");return}this.searchTimeout=setTimeout(()=>{this.searchCities(t)},300)}handleCityFocus(){this.cityInput.value.length>=2&&this.cityDropdown.classList.add("active")}handleOutsideClick(t){t.target.closest(".autocomplete-wrapper")||(this.countryDropdown.classList.remove("active"),this.cityDropdown.classList.remove("active"))}async searchCountries(t){try{this.showLoader("country");const e=await this.api.searchCountries(t);this.renderCountryResults(e)}catch(e){console.error("Error searching countries:",e),this.showError("country")}finally{this.hideLoader("country")}}async searchCities(t){if(this.selectedCountry)try{this.showLoader("city");const e=await this.api.searchCities(this.selectedCountry.code,t);this.renderCityResults(e)}catch(e){console.error("Error searching cities:",e),this.showError("city")}finally{this.hideLoader("city")}}renderCountryResults(t){this.countryDropdown.innerHTML="",t.length===0?this.countryDropdown.innerHTML='<div class="no-results">No countries found</div>':t.forEach(e=>{const r=document.createElement("div");r.className="autocomplete-item",r.textContent=e.name,r.addEventListener("click",()=>this.selectCountry(e)),this.countryDropdown.appendChild(r)}),this.countryDropdown.classList.add("active")}renderCityResults(t){this.cityDropdown.innerHTML="",t.length===0?this.cityDropdown.innerHTML='<div class="no-results">No cities found</div>':t.forEach(e=>{const r=document.createElement("div");r.className="autocomplete-item",r.textContent=e.city,r.addEventListener("click",()=>this.selectCity(e)),this.cityDropdown.appendChild(r)}),this.cityDropdown.classList.add("active")}selectCountry(t){this.selectedCountry=t,this.countryInput.value=t.name,this.countryDropdown.classList.remove("active"),this.cityInput.value="",this.cityInput.disabled=!1,this.cityInput.focus(),this.saveFormData()}selectCity(t){this.cityInput.value=t.city,this.cityDropdown.classList.remove("active"),this.saveFormData()}showLoader(t){const e=t==="country"?this.countryLoader:this.cityLoader;e.style.display="block"}hideLoader(t){const e=t==="country"?this.countryLoader:this.cityLoader;e.style.display="none"}showError(t){const e=t==="country"?this.countryDropdown:this.cityDropdown;e.innerHTML='<div class="no-results">Error loading data. Please try again.</div>',e.classList.add("active")}loadSavedData(){const t=localStorage.getItem(c);if(t)try{const e=JSON.parse(t);Object.entries(e).forEach(([r,s])=>{const o=document.getElementById(r);o&&(o.value=s)})}catch(e){console.error("Error loading saved form data:",e)}}saveFormData(){const t=document.getElementById("checkout-form"),e={};t.querySelectorAll("input, select, textarea").forEach(s=>{s.id&&(e[s.id]=s.value)}),localStorage.setItem(c,JSON.stringify(e))}}class l{static validateEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static validatePhone(t){return/^\+?[\d\s-]{10,}$/.test(t)}static showError(t,e){const r=document.createElement("div");r.className="form-field__error",r.textContent=e;const s=t.parentNode.querySelector(".form-field__error");s&&s.remove(),t.classList.add("error"),t.parentNode.appendChild(r)}static removeError(t){const e=t.parentNode.querySelector(".form-field__error");e&&e.remove(),t.classList.remove("error")}static validateForm(t){let e=!0;return t.querySelectorAll("input, select, textarea").forEach(s=>{if(s.required&&!s.value.trim())this.showError(s,"This field is required"),e=!1;else switch(s.type){case"email":this.validateEmail(s.value)||(this.showError(s,"Please enter a valid email"),e=!1);break;case"tel":this.validatePhone(s.value)||(this.showError(s,"Please enter a valid phone number"),e=!1);break;default:this.removeError(s)}}),e}}document.addEventListener("DOMContentLoaded",()=>{new u;const i=document.getElementById("checkout-form");i&&i.addEventListener("submit",t=>{t.preventDefault(),l.validateForm(i)&&console.log("Form is valid, submitting...")})});
